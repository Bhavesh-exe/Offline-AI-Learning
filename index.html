<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI Learning Platform - Offline Education</title>

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#6c63ff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="AI Learn">
    <link rel="manifest" href="manifest.json">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6c63ff;
            --primary-dark: #5a52d9;
            --bg-dark: #1a1a2e;
            --bg-card: #16213e;
            --bg-light: #0f3460;
            --text: #ffffff;
            --text-muted: #a0a0a0;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
        }

        body {
            font-family: 'Segoe UI', Roboto, Arial, sans-serif;
            background: linear-gradient(135deg, var(--bg-dark), var(--bg-card));
            color: var(--text);
            min-height: 100vh;
            display: flex;
        }

        /* Sidebar */
        .sidebar {
            width: 250px;
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            display: flex;
            flex-direction: column;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
        }

        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .subtitle {
            color: var(--text-muted);
            font-size: 0.85rem;
            margin-bottom: 30px;
        }

        .nav-btn {
            width: 100%;
            padding: 12px 15px;
            margin-bottom: 10px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: var(--text);
            font-size: 1rem;
            cursor: pointer;
            text-align: left;
            transition: all 0.3s;
        }

        .nav-btn:hover {
            background: rgba(108, 99, 255, 0.3);
        }

        .nav-btn.active {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
        }

        .stats-section {
            margin-top: auto;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .stat-label {
            color: var(--text-muted);
        }

        .stat-value {
            font-weight: bold;
            color: var(--primary);
        }

        .offline-badge {
            background: var(--success);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            text-align: center;
            font-size: 0.85rem;
            margin-top: 15px;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            max-height: 100vh;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h1 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .page-subtitle {
            color: var(--text-muted);
            margin-bottom: 30px;
        }

        /* Cards */
        .card {
            background: var(--bg-light);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s;
            border-left: 4px solid var(--primary);
        }

        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(108, 99, 255, 0.2);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .card-title {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .card-badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            background: rgba(108, 99, 255, 0.2);
        }

        .card-meta {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        /* Lesson View */
        .lesson-header {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        .lesson-meta {
            background: var(--bg-light);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .meta-label {
            color: var(--text-muted);
            font-size: 0.8rem;
            margin-bottom: 5px;
        }

        .meta-value {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--primary);
        }

        .back-btn {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 1rem;
            margin-bottom: 20px;
            padding: 10px 0;
        }

        .back-btn:hover {
            color: var(--text);
        }

        .section {
            background: var(--bg-light);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
        }

        .section h3 {
            color: var(--primary);
            margin-bottom: 15px;
        }

        .section p {
            line-height: 1.8;
            white-space: pre-line;
        }

        .key-points {
            margin-top: 30px;
        }

        .key-point {
            background: rgba(40, 167, 69, 0.2);
            border-left: 4px solid var(--success);
            padding: 12px 15px;
            margin-bottom: 10px;
            border-radius: 0 8px 8px 0;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(108, 99, 255, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        /* Quiz */
        .quiz-question {
            background: var(--bg-light);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
        }

        .question-text {
            font-size: 1.1rem;
            margin-bottom: 20px;
        }

        .quiz-option {
            display: block;
            width: 100%;
            padding: 15px;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid transparent;
            border-radius: 8px;
            color: white;
            text-align: left;
            cursor: pointer;
            transition: all 0.3s;
        }

        .quiz-option:hover {
            border-color: var(--primary);
            background: rgba(108, 99, 255, 0.1);
        }

        .quiz-option.selected {
            border-color: var(--primary);
            background: rgba(108, 99, 255, 0.2);
        }

        .quiz-option.correct {
            border-color: var(--success);
            background: rgba(40, 167, 69, 0.2);
        }

        .quiz-option.incorrect {
            border-color: var(--danger);
            background: rgba(220, 53, 69, 0.2);
        }

        .feedback {
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            display: none;
        }

        .feedback.show {
            display: block;
        }

        .feedback.correct {
            background: rgba(40, 167, 69, 0.2);
            border-left: 4px solid var(--success);
        }

        .feedback.incorrect {
            background: rgba(220, 53, 69, 0.2);
            border-left: 4px solid var(--danger);
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), #ff6584);
            border-radius: 4px;
            transition: width 0.3s;
        }

        .result-card {
            background: var(--bg-light);
            border-radius: 12px;
            padding: 40px;
            text-align: center;
        }

        .result-score {
            font-size: 4rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 10px;
        }

        /* Progress Page */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--bg-light);
            border-radius: 12px;
            padding: 25px;
            text-align: center;
        }

        .stat-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary);
        }

        .stat-name {
            color: var(--text-muted);
            margin-top: 5px;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            body {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                padding: 15px;
                flex-direction: row;
                flex-wrap: wrap;
                gap: 10px;
            }

            .logo,
            .subtitle {
                width: 100%;
            }

            .nav-btn {
                flex: 1;
                min-width: 80px;
                text-align: center;
                padding: 10px;
            }

            .stats-section {
                display: none;
            }

            .lesson-header {
                grid-template-columns: repeat(2, 1fr);
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Offline banner */
        .offline-banner {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: var(--warning);
            color: #333;
            padding: 10px;
            text-align: center;
            font-weight: 600;
            z-index: 1000;
            display: none;
        }

        .offline-banner.show {
            display: block;
        }
    </style>
</head>

<body>
    <div class="offline-banner" id="offlineBanner">üì¥ You are offline - App running from cache!</div>

    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="logo">üìö AI Learn</div>
        <div class="subtitle">Offline Learning Platform</div>

        <button class="nav-btn active" onclick="showPage('lessons')" id="nav-lessons">üìñ Lessons</button>
        <button class="nav-btn" onclick="showPage('quiz')" id="nav-quiz">üìù Quiz</button>
        <button class="nav-btn" onclick="showPage('progress')" id="nav-progress">üìä Progress</button>

        <div class="stats-section">
            <div class="stat-item">
                <span class="stat-label">Lessons Done</span>
                <span class="stat-value" id="sidebar-lessons">0/5</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Avg Score</span>
                <span class="stat-value" id="sidebar-score">N/A</span>
            </div>
            <div class="offline-badge">üåê Works Offline!</div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Lessons List Page -->
        <div class="page active" id="page-lessons">
            <h1>üìñ Available Lessons</h1>
            <p class="page-subtitle">Select a lesson to start learning!</p>
            <div id="lessons-list"></div>
        </div>

        <!-- Lesson Detail Page -->
        <div class="page" id="page-lesson-detail">
            <button class="back-btn" onclick="showPage('lessons')">‚Üê Back to Lessons</button>
            <div id="lesson-content"></div>
        </div>

        <!-- Quiz Select Page -->
        <div class="page" id="page-quiz">
            <h1>üìù Practice Quiz</h1>
            <p class="page-subtitle">Test your knowledge with auto-generated questions!</p>

            <div class="section">
                <h3>Select a Topic</h3>
                <select id="quiz-topic"
                    style="width:100%; padding:12px; border-radius:8px; background:rgba(255,255,255,0.1); color:white; border:none; font-size:1rem; margin-bottom:20px;">
                </select>
                <button class="btn btn-primary" onclick="startQuiz()" style="width:100%">üöÄ Start Quiz</button>
            </div>

            <div class="section" style="margin-top:30px;">
                <h3>üìä Quiz History</h3>
                <div id="quiz-history"></div>
            </div>
        </div>

        <!-- Quiz Active Page -->
        <div class="page" id="page-quiz-active">
            <h1 id="quiz-title">üìù Quiz</h1>
            <div class="progress-bar">
                <div class="progress-fill" id="quiz-progress"></div>
            </div>
            <div id="quiz-questions"></div>
            <button class="btn btn-primary" id="submit-quiz" onclick="submitQuiz()"
                style="width:100%; margin-top:20px;">Submit Quiz</button>
        </div>

        <!-- Quiz Results Page -->
        <div class="page" id="page-quiz-results">
            <div class="result-card">
                <div class="result-score" id="result-score">0%</div>
                <p id="result-message">Keep practicing!</p>
                <div class="action-buttons" style="justify-content:center; margin-top:30px;">
                    <button class="btn btn-primary" onclick="retryQuiz()">üîÑ Try Again</button>
                    <button class="btn btn-secondary" onclick="showPage('lessons')">üìö Back to Lessons</button>
                </div>
            </div>
        </div>

        <!-- Progress Page -->
        <div class="page" id="page-progress">
            <h1>üìä Your Progress</h1>
            <p class="page-subtitle">Track your learning journey!</p>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">üìö</div>
                    <div class="stat-number" id="progress-lessons">0/5</div>
                    <div class="stat-name">Lessons Completed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üìù</div>
                    <div class="stat-number" id="progress-quizzes">0</div>
                    <div class="stat-name">Quizzes Taken</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üéØ</div>
                    <div class="stat-number" id="progress-avg">N/A</div>
                    <div class="stat-name">Average Score</div>
                </div>
            </div>

            <div class="section">
                <h3>üìö Lesson Progress</h3>
                <div class="progress-bar" style="height:12px; margin-bottom:20px;">
                    <div class="progress-fill" id="lesson-progress-bar"></div>
                </div>
                <div id="lesson-progress-list"></div>
            </div>

            <div class="section">
                <h3>üìù Recent Quiz Scores</h3>
                <div id="progress-quiz-history"></div>
            </div>
        </div>
    </main>

    <script>
        // ============ LESSON DATA ============
        const LESSONS = {
            "motion": {
                id: "motion",
                title: "Motion and Speed",
                subject: "Physics",
                difficulty: "Beginner",
                duration: "15 min",
                objectives: [
                    "Understand what motion means in physics",
                    "Differentiate between distance and displacement",
                    "Calculate speed and velocity"
                ],
                content: [
                    {
                        title: "What is Motion?",
                        text: `Motion is the change in position of an object with respect to time.

Examples:
‚Ä¢ A car moving on a road
‚Ä¢ A bird flying in the sky
‚Ä¢ Earth revolving around the Sun

Motion is always relative - a person sitting in a moving bus is at rest relative to the bus but in motion relative to the ground.`
                    },
                    {
                        title: "Distance vs Displacement",
                        text: `Distance = Total path length traveled (scalar quantity)

Displacement = Shortest path between start and end (vector quantity)

Example: Walking 3 km east then 4 km north:
‚Ä¢ Distance = 3 + 4 = 7 km
‚Ä¢ Displacement = 5 km (using Pythagorean theorem)`
                    },
                    {
                        title: "Speed and Velocity",
                        text: `Speed = Distance / Time (scalar)
Velocity = Displacement / Time (vector)

Units: m/s or km/h

Example: A car travels 100 km in 2 hours
Speed = 100/2 = 50 km/h`
                    }
                ],
                keyPoints: [
                    "Motion is change in position over time",
                    "Distance is scalar; displacement is vector",
                    "Speed is scalar; velocity is vector"
                ],
                quiz: [
                    { q: "What is the SI unit of speed?", options: ["km/h", "m/s", "cm/s", "mph"], answer: 1, explanation: "The SI unit of speed is meters per second (m/s)." },
                    { q: "A car travels 150 km in 3 hours. Average speed is:", options: ["30 km/h", "40 km/h", "50 km/h", "60 km/h"], answer: 2, explanation: "Speed = Distance/Time = 150/3 = 50 km/h" },
                    { q: "Which has both magnitude and direction?", options: ["Distance", "Speed", "Displacement", "Time"], answer: 2, explanation: "Displacement is a vector quantity." },
                    { q: "Walking in a circle back to start, displacement is:", options: ["Equal to distance", "Half distance", "Zero", "Cannot determine"], answer: 2, explanation: "Displacement is zero when start and end are same." }
                ]
            },
            "force": {
                id: "force",
                title: "Force and Laws of Motion",
                subject: "Physics",
                difficulty: "Intermediate",
                duration: "20 min",
                objectives: [
                    "Understand the concept of force",
                    "Learn Newton's three laws of motion",
                    "Apply laws to solve problems"
                ],
                content: [
                    {
                        title: "What is Force?",
                        text: `Force is a push or pull that can change an object's motion.

Effects of force:
‚Ä¢ Start or stop motion
‚Ä¢ Change speed
‚Ä¢ Change direction
‚Ä¢ Change shape

Unit: Newton (N)`
                    },
                    {
                        title: "Newton's First Law (Inertia)",
                        text: `An object at rest stays at rest, and an object in motion stays in motion with the same speed and direction, unless acted upon by an unbalanced force.

Examples:
‚Ä¢ Passengers lurch forward when bus stops suddenly
‚Ä¢ Ball keeps rolling until friction stops it
‚Ä¢ Dust flies off when you shake a carpet`
                    },
                    {
                        title: "Newton's Second Law",
                        text: `F = m √ó a

Where:
‚Ä¢ F = Force (Newtons)
‚Ä¢ m = Mass (kg)
‚Ä¢ a = Acceleration (m/s¬≤)

Example: 10 kg object accelerates at 5 m/s¬≤
Force = 10 √ó 5 = 50 N`
                    },
                    {
                        title: "Newton's Third Law",
                        text: `For every action, there is an equal and opposite reaction.

Examples:
‚Ä¢ Rocket pushes gas down, gas pushes rocket up
‚Ä¢ You push wall, wall pushes you back
‚Ä¢ Gun recoils when bullet fires`
                    }
                ],
                keyPoints: [
                    "Force is measured in Newtons (N)",
                    "First Law: Objects resist changes (inertia)",
                    "Second Law: F = m √ó a",
                    "Third Law: Action = Reaction"
                ],
                quiz: [
                    { q: "SI unit of force is:", options: ["Joule", "Newton", "Pascal", "Watt"], answer: 1, explanation: "The SI unit of force is Newton (N)." },
                    { q: "5 kg pushed with 20 N. Acceleration is:", options: ["2 m/s¬≤", "4 m/s¬≤", "25 m/s¬≤", "100 m/s¬≤"], answer: 1, explanation: "a = F/m = 20/5 = 4 m/s¬≤" },
                    { q: "Why are seatbelts important?", options: ["First Law", "Second Law", "Third Law", "Gravitation"], answer: 0, explanation: "First Law (Inertia) - body continues moving when car stops." }
                ]
            },
            "gravity": {
                id: "gravity",
                title: "Gravitation",
                subject: "Physics",
                difficulty: "Intermediate",
                duration: "18 min",
                objectives: [
                    "Understand Newton's Law of Gravitation",
                    "Learn about acceleration due to gravity",
                    "Differentiate between mass and weight"
                ],
                content: [
                    {
                        title: "Universal Law of Gravitation",
                        text: `Every object attracts every other object with a force:

F = G √ó (m‚ÇÅ √ó m‚ÇÇ) / r¬≤

Where:
‚Ä¢ G = 6.67 √ó 10‚Åª¬π¬π Nm¬≤/kg¬≤
‚Ä¢ m‚ÇÅ, m‚ÇÇ = Masses of objects
‚Ä¢ r = Distance between centers`
                    },
                    {
                        title: "Acceleration Due to Gravity",
                        text: `On Earth's surface: g = 9.8 m/s¬≤

Variations:
‚Ä¢ Maximum at poles
‚Ä¢ Minimum at equator
‚Ä¢ Decreases with altitude
‚Ä¢ Decreases with depth`
                    },
                    {
                        title: "Mass vs Weight",
                        text: `Mass:
‚Ä¢ Amount of matter in an object
‚Ä¢ Constant everywhere
‚Ä¢ Unit: kilogram (kg)

Weight = m √ó g
‚Ä¢ Gravitational force on object
‚Ä¢ Changes with location
‚Ä¢ Unit: Newton (N)

Example: 60 kg person
‚Ä¢ On Earth: W = 60 √ó 9.8 = 588 N
‚Ä¢ On Moon: W = 60 √ó 1.6 = 96 N`
                    }
                ],
                keyPoints: [
                    "g ‚âà 9.8 m/s¬≤ on Earth's surface",
                    "Weight = mass √ó g",
                    "Mass is constant; weight varies with location"
                ],
                quiz: [
                    { q: "Value of g on Earth is:", options: ["9.8 m/s", "9.8 m/s¬≤", "10 km/h", "6.67 m/s¬≤"], answer: 1, explanation: "g = 9.8 m/s¬≤ (meters per second squared)" },
                    { q: "Weight of 10 kg object (g=10):", options: ["10 N", "100 N", "1 N", "10 kg"], answer: 1, explanation: "W = mg = 10 √ó 10 = 100 N" }
                ]
            },
            "energy": {
                id: "energy",
                title: "Work, Energy and Power",
                subject: "Physics",
                difficulty: "Intermediate",
                duration: "22 min",
                objectives: [
                    "Understand scientific meaning of work",
                    "Learn about kinetic and potential energy",
                    "Calculate power"
                ],
                content: [
                    {
                        title: "What is Work?",
                        text: `Work is done when force causes displacement.

W = F √ó d

Where:
‚Ä¢ W = Work (Joules)
‚Ä¢ F = Force (Newtons)
‚Ä¢ d = Displacement (meters)

Work requires: Force + Movement in force direction`
                    },
                    {
                        title: "Types of Energy",
                        text: `Kinetic Energy: KE = ¬Ωmv¬≤
Energy of motion

Potential Energy: PE = mgh
Energy due to position

Law of Conservation: Energy cannot be created or destroyed, only transformed.
PE ‚Üî KE (transformation)`
                    },
                    {
                        title: "Power",
                        text: `Power = Work / Time

P = W/t

Units:
‚Ä¢ Watt (W) = 1 Joule/second
‚Ä¢ 1 kilowatt (kW) = 1000 W
‚Ä¢ 1 horsepower (HP) = 746 W`
                    }
                ],
                keyPoints: [
                    "Work = Force √ó Displacement (Joules)",
                    "KE = ¬Ωmv¬≤, PE = mgh",
                    "Power = Work/Time (Watts)"
                ],
                quiz: [
                    { q: "SI unit of work is:", options: ["Newton", "Watt", "Joule", "Pascal"], answer: 2, explanation: "Work is measured in Joules (J)" },
                    { q: "KE of 2 kg at 10 m/s:", options: ["20 J", "100 J", "50 J", "200 J"], answer: 1, explanation: "KE = ¬Ωmv¬≤ = ¬Ω√ó2√ó100 = 100 J" }
                ]
            },
            "sound": {
                id: "sound",
                title: "Sound",
                subject: "Physics",
                difficulty: "Intermediate",
                duration: "20 min",
                objectives: [
                    "Understand how sound is produced",
                    "Learn about sound wave properties",
                    "Explore speed of sound"
                ],
                content: [
                    {
                        title: "Production of Sound",
                        text: `Sound is produced by vibrating objects.

Examples:
‚Ä¢ Vocal cords vibrate to produce voice
‚Ä¢ Guitar strings vibrate to make music
‚Ä¢ Drum membrane vibrates when struck

Important: Sound needs a medium to travel.
It cannot travel through vacuum (space)!`
                    },
                    {
                        title: "Sound Waves",
                        text: `Sound travels as longitudinal waves.

Compressions: High pressure regions (particles close)
Rarefactions: Low pressure regions (particles far)

Properties:
‚Ä¢ Wavelength (Œª) - distance between waves
‚Ä¢ Frequency (Hz) - waves per second
‚Ä¢ Amplitude - determines loudness`
                    },
                    {
                        title: "Speed of Sound",
                        text: `v = f √ó Œª (Speed = Frequency √ó Wavelength)

Speed in different media:
‚Ä¢ Air: 343 m/s
‚Ä¢ Water: 1498 m/s
‚Ä¢ Steel: 5960 m/s

Rule: Sound travels fastest in Solids > Liquids > Gases`
                    }
                ],
                keyPoints: [
                    "Sound needs a medium to travel",
                    "Sound waves are longitudinal",
                    "Speed: Solid > Liquid > Gas"
                ],
                quiz: [
                    { q: "Sound waves are:", options: ["Transverse", "Longitudinal", "Electromagnetic", "Surface"], answer: 1, explanation: "Sound waves are longitudinal waves." },
                    { q: "Sound travels fastest in:", options: ["Air", "Water", "Steel", "Vacuum"], answer: 2, explanation: "Sound travels fastest in solids like steel." }
                ]
            }
        };

        // ============ STATE MANAGEMENT ============
        let state = {
            completedLessons: [],
            quizScores: [],
            currentQuiz: null,
            quizAnswers: {}
        };

        // Load state from localStorage
        function loadState() {
            const saved = localStorage.getItem('ailearn_progress');
            if (saved) {
                state = JSON.parse(saved);
            }
        }

        // Save state to localStorage
        function saveState() {
            localStorage.setItem('ailearn_progress', JSON.stringify(state));
            updateSidebarStats();
        }

        // ============ NAVIGATION ============
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            // Show selected page
            document.getElementById('page-' + pageId).classList.add('active');
            // Update nav buttons
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            const navBtn = document.getElementById('nav-' + pageId);
            if (navBtn) navBtn.classList.add('active');

            // Load page-specific content
            if (pageId === 'lessons') renderLessonsList();
            if (pageId === 'quiz') renderQuizSelect();
            if (pageId === 'progress') renderProgress();
        }

        // ============ LESSONS ============
        function renderLessonsList() {
            const container = document.getElementById('lessons-list');
            container.innerHTML = '';

            Object.values(LESSONS).forEach(lesson => {
                const completed = state.completedLessons.includes(lesson.id);
                const card = document.createElement('div');
                card.className = 'card';
                card.onclick = () => showLesson(lesson.id);
                card.innerHTML = `
                    <div class="card-header">
                        <span class="card-title">${completed ? '‚úÖ' : 'üìñ'} ${lesson.title}</span>
                        <span class="card-badge">${lesson.difficulty}</span>
                    </div>
                    <div class="card-meta">${lesson.subject} ‚Ä¢ ${lesson.duration}</div>
                `;
                container.appendChild(card);
            });
        }

        function showLesson(lessonId) {
            const lesson = LESSONS[lessonId];
            if (!lesson) return;

            const completed = state.completedLessons.includes(lessonId);
            const container = document.getElementById('lesson-content');

            container.innerHTML = `
                <h1>${lesson.title}</h1>
                <div class="lesson-header">
                    <div class="lesson-meta">
                        <div class="meta-label">Subject</div>
                        <div class="meta-value">${lesson.subject}</div>
                    </div>
                    <div class="lesson-meta">
                        <div class="meta-label">Difficulty</div>
                        <div class="meta-value">${lesson.difficulty}</div>
                    </div>
                    <div class="lesson-meta">
                        <div class="meta-label">Duration</div>
                        <div class="meta-value">${lesson.duration}</div>
                    </div>
                    <div class="lesson-meta">
                        <div class="meta-label">Status</div>
                        <div class="meta-value">${completed ? '‚úÖ Done' : 'üìñ In Progress'}</div>
                    </div>
                </div>
                
                <div class="section">
                    <h3>üéØ Learning Objectives</h3>
                    <ul style="padding-left: 20px; line-height: 2;">
                        ${lesson.objectives.map(o => `<li>${o}</li>`).join('')}
                    </ul>
                </div>
                
                ${lesson.content.map(section => `
                    <div class="section">
                        <h3>${section.title}</h3>
                        <p>${section.text}</p>
                    </div>
                `).join('')}
                
                <div class="key-points">
                    <h3 style="margin-bottom: 15px;">üìå Key Points to Remember</h3>
                    ${lesson.keyPoints.map(p => `<div class="key-point">‚úì ${p}</div>`).join('')}
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="markComplete('${lessonId}')">‚úÖ Mark Complete</button>
                    <button class="btn btn-secondary" onclick="startQuizFor('${lessonId}')">üìù Take Quiz</button>
                </div>
            `;

            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('page-lesson-detail').classList.add('active');
        }

        function markComplete(lessonId) {
            if (!state.completedLessons.includes(lessonId)) {
                state.completedLessons.push(lessonId);
                saveState();
            }
            showLesson(lessonId); // Refresh to show updated status
            alert('üéâ Lesson marked as complete!');
        }

        // ============ QUIZ ============
        function renderQuizSelect() {
            const select = document.getElementById('quiz-topic');
            select.innerHTML = Object.values(LESSONS).map(l =>
                `<option value="${l.id}">${l.title}</option>`
            ).join('');

            renderQuizHistory();
        }

        function renderQuizHistory() {
            const container = document.getElementById('quiz-history');
            if (state.quizScores.length === 0) {
                container.innerHTML = '<p style="color: var(--text-muted);">No quiz history yet. Take a quiz to see your scores!</p>';
                return;
            }

            container.innerHTML = state.quizScores.slice(-5).reverse().map(score => {
                const lesson = LESSONS[score.lessonId];
                const emoji = score.percent >= 80 ? 'üü¢' : score.percent >= 60 ? 'üü°' : 'üî¥';
                return `<div style="padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.1);">
                    ${emoji} <strong>${lesson ? lesson.title : score.lessonId}</strong>: ${score.percent}%
                </div>`;
            }).join('');
        }

        function startQuiz() {
            const lessonId = document.getElementById('quiz-topic').value;
            startQuizFor(lessonId);
        }

        function startQuizFor(lessonId) {
            const lesson = LESSONS[lessonId];
            if (!lesson) return;

            state.currentQuiz = lessonId;
            state.quizAnswers = {};

            document.getElementById('quiz-title').textContent = `üìù Quiz: ${lesson.title}`;

            const container = document.getElementById('quiz-questions');
            container.innerHTML = lesson.quiz.map((q, i) => `
                <div class="quiz-question" id="question-${i}">
                    <div class="question-text"><strong>Q${i + 1}.</strong> ${q.q}</div>
                    ${q.options.map((opt, j) => `
                        <button class="quiz-option" onclick="selectAnswer(${i}, ${j})" id="opt-${i}-${j}">${opt}</button>
                    `).join('')}
                    <div class="feedback" id="feedback-${i}"></div>
                </div>
            `).join('');

            document.getElementById('submit-quiz').style.display = 'block';
            updateQuizProgress();

            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('page-quiz-active').classList.add('active');
        }

        function selectAnswer(questionIdx, optionIdx) {
            state.quizAnswers[questionIdx] = optionIdx;

            // Update UI
            const lesson = LESSONS[state.currentQuiz];
            lesson.quiz[questionIdx].options.forEach((_, j) => {
                document.getElementById(`opt-${questionIdx}-${j}`).classList.remove('selected');
            });
            document.getElementById(`opt-${questionIdx}-${optionIdx}`).classList.add('selected');

            updateQuizProgress();
        }

        function updateQuizProgress() {
            const lesson = LESSONS[state.currentQuiz];
            const answered = Object.keys(state.quizAnswers).length;
            const total = lesson.quiz.length;
            const percent = (answered / total) * 100;
            document.getElementById('quiz-progress').style.width = percent + '%';
        }

        function submitQuiz() {
            const lesson = LESSONS[state.currentQuiz];
            let correct = 0;

            lesson.quiz.forEach((q, i) => {
                const userAnswer = state.quizAnswers[i];
                const isCorrect = userAnswer === q.answer;
                if (isCorrect) correct++;

                // Show feedback
                q.options.forEach((_, j) => {
                    const btn = document.getElementById(`opt-${i}-${j}`);
                    btn.classList.remove('selected');
                    if (j === q.answer) btn.classList.add('correct');
                    else if (j === userAnswer && !isCorrect) btn.classList.add('incorrect');
                });

                const feedback = document.getElementById(`feedback-${i}`);
                feedback.className = `feedback show ${isCorrect ? 'correct' : 'incorrect'}`;
                feedback.innerHTML = `${isCorrect ? '‚úÖ Correct!' : '‚ùå Incorrect.'} ${q.explanation}`;
            });

            const percent = Math.round((correct / lesson.quiz.length) * 100);

            // Save score
            state.quizScores.push({
                lessonId: state.currentQuiz,
                correct: correct,
                total: lesson.quiz.length,
                percent: percent
            });
            saveState();

            // Show results after delay
            setTimeout(() => {
                document.getElementById('result-score').textContent = percent + '%';
                document.getElementById('result-message').textContent =
                    percent >= 80 ? 'üéâ Excellent work!' :
                        percent >= 60 ? 'üëç Good job!' : 'üìö Keep practicing!';

                document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                document.getElementById('page-quiz-results').classList.add('active');
            }, 1500);

            document.getElementById('submit-quiz').style.display = 'none';
        }

        function retryQuiz() {
            startQuizFor(state.currentQuiz);
        }

        // ============ PROGRESS ============
        function renderProgress() {
            const totalLessons = Object.keys(LESSONS).length;
            const completedCount = state.completedLessons.length;

            document.getElementById('progress-lessons').textContent = `${completedCount}/${totalLessons}`;
            document.getElementById('progress-quizzes').textContent = state.quizScores.length;

            if (state.quizScores.length > 0) {
                const avg = state.quizScores.reduce((sum, s) => sum + s.percent, 0) / state.quizScores.length;
                document.getElementById('progress-avg').textContent = Math.round(avg) + '%';
            }

            // Lesson progress bar
            document.getElementById('lesson-progress-bar').style.width = (completedCount / totalLessons * 100) + '%';

            // Lesson list
            document.getElementById('lesson-progress-list').innerHTML = Object.values(LESSONS).map(lesson => {
                const done = state.completedLessons.includes(lesson.id);
                return `<div style="padding: 8px 0;">${done ? '‚úÖ' : '‚¨ú'} ${done ? `<s>${lesson.title}</s>` : lesson.title}</div>`;
            }).join('');

            // Quiz history
            const historyContainer = document.getElementById('progress-quiz-history');
            if (state.quizScores.length === 0) {
                historyContainer.innerHTML = '<p style="color: var(--text-muted);">Take a quiz to see your scores here!</p>';
            } else {
                historyContainer.innerHTML = state.quizScores.slice(-5).reverse().map(score => {
                    const lesson = LESSONS[score.lessonId];
                    const emoji = score.percent >= 80 ? 'üü¢' : score.percent >= 60 ? 'üü°' : 'üî¥';
                    return `<div style="padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.1);">
                        ${emoji} <strong>${lesson ? lesson.title : score.lessonId}</strong>: ${score.correct}/${score.total} (${score.percent}%)
                    </div>`;
                }).join('');
            }
        }

        function updateSidebarStats() {
            const totalLessons = Object.keys(LESSONS).length;
            document.getElementById('sidebar-lessons').textContent = `${state.completedLessons.length}/${totalLessons}`;

            if (state.quizScores.length > 0) {
                const avg = state.quizScores.reduce((sum, s) => sum + s.percent, 0) / state.quizScores.length;
                document.getElementById('sidebar-score').textContent = Math.round(avg) + '%';
            }
        }

        // ============ OFFLINE DETECTION ============
        function updateOnlineStatus() {
            const banner = document.getElementById('offlineBanner');
            if (navigator.onLine) {
                banner.classList.remove('show');
            } else {
                banner.classList.add('show');
            }
        }

        // ============ SERVICE WORKER ============
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js')
                .then(reg => console.log('SW registered'))
                .catch(err => console.log('SW failed:', err));
        }

        // ============ INIT ============
        window.addEventListener('online', updateOnlineStatus);
        window.addEventListener('offline', updateOnlineStatus);

        loadState();
        updateSidebarStats();
        renderLessonsList();
        updateOnlineStatus();
    </script>
</body>

</html>